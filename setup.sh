#!/bin/bash

# FlowLang Quick Setup Script
# Makes it easy to get started with FlowLang

set -e  # Exit on any error

echo "ðŸš€ FlowLang Quick Setup"
echo "====================="

# Check prerequisites
echo "ðŸ“‹ Checking prerequisites..."

# Check .NET
if ! command -v dotnet &> /dev/null; then
    echo "âŒ .NET SDK not found. Please install .NET 8.0+ from https://dotnet.microsoft.com/download"
    exit 1
fi

DOTNET_VERSION=$(dotnet --version)
echo "âœ… .NET SDK found: $DOTNET_VERSION"

# Build FlowLang
echo ""
echo "ðŸ”¨ Building FlowLang transpiler..."
cd src
dotnet build
if [ $? -eq 0 ]; then
    echo "âœ… Build successful!"
else
    echo "âŒ Build failed. Please check the error messages above."
    exit 1
fi

cd ..

# Create flowc alias helper script
echo ""
echo "ðŸ”§ Creating helper script..."

FLOWLANG_ROOT=$(pwd)
HELPER_SCRIPT="$HOME/.flowc"

cat > "$HELPER_SCRIPT" << EOF
#!/bin/bash
# FlowLang Helper Script
# Auto-generated by setup.sh

dotnet run --project "$FLOWLANG_ROOT/src/flowc.csproj" -- "\$@"
EOF

chmod +x "$HELPER_SCRIPT"

# Add to PATH suggestions
echo ""
echo "ðŸŽ‰ Setup complete!"
echo ""
echo "ðŸ’¡ To use FlowLang easily, add this alias to your shell profile:"
echo ""
echo "   echo 'alias flowc=\"$HELPER_SCRIPT\"' >> ~/.bashrc"
echo "   source ~/.bashrc"
echo ""
echo "   # OR for zsh:"
echo "   echo 'alias flowc=\"$HELPER_SCRIPT\"' >> ~/.zshrc"
echo "   source ~/.zshrc"
echo ""
echo "ðŸ§ª Test your installation:"
echo ""
echo "   # Create a test file"
echo '   echo "function main() -> string { return \"Hello, FlowLang!\" }" > test.flow'
echo ""
echo "   # Run it (from this directory):"
echo "   dotnet run --project src/flowc.csproj -- run test.flow"
echo ""
echo "   # Or with alias (after setting it up):"
echo "   flowc run test.flow"
echo ""
echo "ðŸ“š Next steps:"
echo "   - Read the Getting Started guide: docs/getting-started.md"
echo "   - Try the examples in examples/"
echo "   - Create a new project: flowc new my-project"
echo ""
echo "Happy coding! ðŸŽ‰"